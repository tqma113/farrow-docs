(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{116:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return h}));var r=n(0),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=o.a.createContext({}),p=function(e){var t=o.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},b=function(e){var t=p(e.components);return o.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},u=o.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),b=p(n),u=r,h=b["".concat(i,".").concat(u)]||b[u]||d[u]||a;return n?o.a.createElement(h,l(l({ref:t},s),{},{components:n})):o.a.createElement(h,l({ref:t},s))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<a;s++)i[s]=n[s];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},97:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var r=n(3),o=n(7),a=(n(0),n(116)),i={title:"farrow-next"},l={unversionedId:"api/13-farrow-next",id:"api/13-farrow-next",isDocsHomePage:!1,title:"farrow-next",description:"farrow-next is an upper-level business framework based on the next.js package, containing",source:"@site/docs/api/13-farrow-next.md",slug:"/api/13-farrow-next",permalink:"/farrow-docs/build/docs/api/13-farrow-next",editUrl:"https://github.com/Lucifier129/farrow-docs/docs/api/13-farrow-next.md",version:"current",sidebar:"docs",previous:{title:"farrow-module",permalink:"/farrow-docs/build/docs/api/12-farrow-module"},next:{title:"farrow-next-server",permalink:"/farrow-docs/build/docs/api/14-farrow-next-server"}},c=[{value:"Installation",id:"installation",children:[]},{value:"Contents",id:"contents",children:[]},{value:"Basic Usage",id:"basic-usage",children:[{value:"Step 1: Define the Controller",id:"step-1-define-the-controller",children:[]}]},{value:"Step 2: Defining View",id:"step-2-defining-view",children:[{value:"Step 3: Create the Page component",id:"step-3-create-the-page-component",children:[]},{value:"Step 4: Expose the Page component",id:"step-4-expose-the-page-component",children:[]}]},{value:"API",id:"api",children:[{value:"React Hooks API",id:"react-hooks-api",children:[]},{value:"Controller API",id:"controller-api",children:[]},{value:"Controller Life-Cycle",id:"controller-life-cycle",children:[]},{value:"Page Api",id:"page-api",children:[]},{value:"Dependency Injection",id:"dependency-injection",children:[]}]}],s={toc:c};function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"farrow-next")," is an upper-level business framework based on the ",Object(a.b)("inlineCode",{parentName:"p"},"next.js")," package, containing"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},"A conceptual architecture based on the classic ",Object(a.b)("inlineCode",{parentName:"p"},"MVC"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},"A ",Object(a.b)("inlineCode",{parentName:"p"},"redux-based")," state management")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},"Based on the model of ",Object(a.b)("inlineCode",{parentName:"p"},"Inverse of Control")," and ",Object(a.b)("inlineCode",{parentName:"p"},"Dependency Injection")," to manage business code")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},"Provides a friendly ",Object(a.b)("inlineCode",{parentName:"p"},"React-Hooks api"))),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},"Wraps ",Object(a.b)("inlineCode",{parentName:"p"},"cookie|fetch|userAgent")," and other convenient isomorphic methods")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},"Based on ",Object(a.b)("inlineCode",{parentName:"p"},"TypeScript")," development, providing good type derivation capabilities")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},"..."))),Object(a.b)("h2",{id:"installation"},"Installation"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-shell"},"# via npm\nnpm install --save farrow-next\n\n# via yarn\nyarn add farrow-next\n")),Object(a.b)("h2",{id:"contents"},"Contents"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"#basic-usage"},"Basic Usage")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"#react-hooks-api"},"React Hooks API")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"#controller-api"},"Controller API")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"#controller-life-cycle"},"Controller Life-Cycle")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"#page-api"},"Page Api")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{parentName:"li",href:"#dependency-injection"},"Dependency Injection"))),Object(a.b)("h2",{id:"basic-usage"},"Basic Usage"),Object(a.b)("p",null,"Each page consists of 3 parts: ",Object(a.b)("inlineCode",{parentName:"p"},"Model"),", ",Object(a.b)("inlineCode",{parentName:"p"},"View"),", ",Object(a.b)("inlineCode",{parentName:"p"},"Controller"),"."),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"Model")," manages the state of the application and its changes"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"View")," manages the interface of the application and its event binding"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"Controller")," manages the asynchronous interaction of the application (e.g. requesting data)")),Object(a.b)("p",null,"In ",Object(a.b)("inlineCode",{parentName:"p"},"farrow-next"),", the ",Object(a.b)("inlineCode",{parentName:"p"},"Model")," is inside the ",Object(a.b)("inlineCode",{parentName:"p"},"Controller")," and each ",Object(a.b)("inlineCode",{parentName:"p"},"Controller")," has its own ",Object(a.b)("inlineCode",{parentName:"p"},"Model")," that it maintains."),Object(a.b)("p",null,"Each ",Object(a.b)("inlineCode",{parentName:"p"},"Model")," consists of ",Object(a.b)("inlineCode",{parentName:"p"},"state")," and ",Object(a.b)("inlineCode",{parentName:"p"},"reducers/actions"),", which can be understood as a ",Object(a.b)("inlineCode",{parentName:"p"},"redux-store"),"."),Object(a.b)("p",null,"There is only one ",Object(a.b)("inlineCode",{parentName:"p"},"View"),", but there can be multiple ",Object(a.b)("inlineCode",{parentName:"p"},"Controllers"),"."),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"View")," accesses the ",Object(a.b)("inlineCode",{parentName:"p"},"state, actions")," and other properties or methods inside each ",Object(a.b)("inlineCode",{parentName:"p"},"Controller")," through the ",Object(a.b)("inlineCode",{parentName:"p"},"hooks api"),"."),Object(a.b)("h3",{id:"step-1-define-the-controller"},"Step 1: Define the Controller"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"Controller")," can be defined as many times as needed."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"// counter/Controller.ts\nimport { Controller } from 'farrow-next'\n\n/**\n * Define state type\n */\nexport type CounterState = {\n  count: number\n}\n\n/*\n * Define Controller\n */\nexport class Counter extends Controller {\n  /**\n   * add the initial state\n   */\n  initialState: CounterState = {\n    count: 0,\n  }\n\n  /**\n   * Define reducers\n   * expresses the actions to update the state\n   */\n  reducers = {\n    incre(state: CounterState, step = 1) {\n      return {\n        ...state,\n        count: state.count + step,\n      }\n    },\n    decre(state: CounterState, step = 1) {\n      return {\n        ...state,\n        count: state.count - step,\n      }\n    },\n  }\n\n  /**\n   * Whether to enable redux-devtools\n   * default is true\n   */\n  devtools = true\n\n  /**\n   * Whether to enable redux-logger\n   * default is false\n   */\n  logger = false\n\n  /**\n   * Declare the preload lifecycle function\n   * This function is called before the component is rendered and corresponds to the timing of the execution of getInitialProps\n   * In this function, asynchronous processing is done to call actions to update the store\n   */\n  async preload() {\n    /*\n     * Access to the latest state\n     * internally execute this.store.getState()\n     */\n    this.state\n\n    /**\n     * Call action\n     * this.actions has the same key as this.reducers\n     * but it is bound to this.store, which will automatically update the state in store when called\n     */\n    this.actions.incre(10)\n\n    /**\n     * Access the uesr-agent string\n     * On the server side, it is automatically retrieved from req.headers['user-agent'].\n     * On the client side it is retrieved from window.navigator.userAgent\n     This.userAgent \n     */\n    this.userAgent\n\n    /*\n     * Access to cookies\n     * Internally, it automatically coordinates the server/client to break different cookie sources\n     */\n    this.getCookie('a')\n    this.setCookie('a', 'b')\n\n    /**\n     * Send a GET request\n     * The first parameter is the request address\n     * The second parameter is the requested query string\n     * internally it will be spliced as /pathname?a=1&b=abc\n     * Return an asynchronous json object\n     */\n    let json = await this.getJson('/pathname', {\n      a: 1,\n      b: 'abc',\n    })\n\n    /**\n     * Send a POST request\n     * The first parameter is the request address\n     * The second parameter is the body\n     * returns an asynchronous json object\n     */\n    let json = await this.postJson('/pathname', {\n      a: 1,\n      b: 'abc',\n    })\n  }\n}\n")),Object(a.b)("h2",{id:"step-2-defining-view"},"Step 2: Defining View"),Object(a.b)("p",null,"A ",Object(a.b)("inlineCode",{parentName:"p"},"View")," is a ",Object(a.b)("inlineCode",{parentName:"p"},"React Component"),", and in any function component, you can:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},"Get an instance of ",Object(a.b)("inlineCode",{parentName:"p"},"Controller")," with ",Object(a.b)("inlineCode",{parentName:"p"},"Controller.use()"),".")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("p",{parentName:"li"},"Pull state data from ",Object(a.b)("inlineCode",{parentName:"p"},"Controller")," via ",Object(a.b)("inlineCode",{parentName:"p"},"Controller.useState(selector?)"),", and automatically update the view when the state changes"))),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-tsx"},"// counter/View.tsx\nimport React from 'react'\nimport { Counter } from '. /controllers/Counter'\n\nexport const View = () => {\n  // Get the instance\n  const counter = Counter.use()\n  // Get and listen for state changes\n  const count = Counter.useState((state) => state.count)\n  return (\n    <>\n      <h1>count: {count}</h1>\n      <button type=\"button\" onClick={() => counter.actions.incre(10)}>\n        incre\n      </button> <button type=\"button\" onClick={() => counter.actions.decre()}>\n        decre\n      </button>\n    </>\n  )\n}\n")),Object(a.b)("h3",{id:"step-3-create-the-page-component"},"Step 3: Create the Page component"),Object(a.b)("p",null,"After completing the two steps, we need to bind them together to create a page."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"// counter/index.tsx\nimport { page } from 'farrow-next'\nimport { Counter } from '. /controllers/Counter'\nimport { View } from '. /View'\n\n/**\n * page(options) create Page component\n */\nexport default page({\n  View: View,\n  /**\n   * Bind the Controllers that the view depends on\n   * Only the bound Controllers are accessible via hooks in the component\n   */\n  Controllers: {\n    counter: Counter,\n  },\n\n  /**\n   * preload callback\n   * It will be executed after all controller.preload() executions are finished\n   * Instances with parameters in the page#Controllers field can access their data and call their methods.\n   */\n  async preload({ counter }) {\n    counter.actions.incre()\n  },\n})\n")),Object(a.b)("h3",{id:"step-4-expose-the-page-component"},"Step 4: Expose the Page component"),Object(a.b)("p",null,"In ",Object(a.b)("inlineCode",{parentName:"p"},"pages/xxx.ts"),", expose the ",Object(a.b)("inlineCode",{parentName:"p"},"Page")," component to be accessible via url."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"// pages/counter.ts\nexport { default } from '. /src/pages/counter'\n")),Object(a.b)("h2",{id:"api"},"API"),Object(a.b)("h3",{id:"react-hooks-api"},"React Hooks API"),Object(a.b)("h4",{id:"controlleruse"},"Controller.use()"),Object(a.b)("p",null,"Get the ",Object(a.b)("inlineCode",{parentName:"p"},"Controller")," instance in the ",Object(a.b)("inlineCode",{parentName:"p"},"React Function Component")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"let ctrl = Controller.use()\n")),Object(a.b)("h4",{id:"controllerusestateselector-compare"},"Controller.useState(selector?, compare?)"),Object(a.b)("p",null,"Get and listen to ",Object(a.b)("inlineCode",{parentName:"p"},"Controller"),"'s ",Object(a.b)("inlineCode",{parentName:"p"},"state")," in ",Object(a.b)("inlineCode",{parentName:"p"},"React Function Component")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"selector (optional) with ",Object(a.b)("inlineCode",{parentName:"li"},"state")," as argument returns the result of the state selected from it, default is state => state"),Object(a.b)("li",{parentName:"ul"},"compare (optional), with ",Object(a.b)("inlineCode",{parentName:"li"},"(currState, prevState)"),", returns ",Object(a.b)("inlineCode",{parentName:"li"},"true")," if the component needs to be re-rendered, or ",Object(a.b)("inlineCode",{parentName:"li"},"false")," if it is not. The default is ",Object(a.b)("inlineCode",{parentName:"li"},"shallowEqual")," which is shallow compared two object.")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"let state = Controller.useState((state) => state, shallowEqual)\n")),Object(a.b)("h4",{id:"usepageinfo-pageinfo"},"usePageInfo(): PageInfo"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"usePageInfo")," to access current page info"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"import { usePageInfo } from 'farrow-next'\n\nconst App = () => {\n  let pageInfo = usePageInfo()\n  // ...\n}\n\ntype PageInfo = {\n  /**\n   * userAgent\n   */\n  userAgent?: string\n\n  /**\n   * Error object if encountered during rendering\n   */\n  err?: NextPageContext['err']\n\n  /**\n   * `HTTP` request object.\n   */\n  req?: NextPageContext['req']\n\n  /**\n   * `HTTP` response object.\n   */\n  res?: NextPageContext['res']\n\n  /**\n   * Path section of `URL`.\n   */\n  pathname: NextPageContext['pathname']\n\n  /**\n   * Query string section of `URL` parsed as an object.\n   */\n  query: NextPageContext['query']\n\n  /**\n   * `String` of the actual path including query.\n   */\n  asPath?: NextPageContext['asPath']\n}\n")),Object(a.b)("h4",{id:"usequerychangedeffecteffectcallback"},"useQueryChangedEffect(effectCallback)"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"useQueryChangedEffect")," to perform effect when query was changed"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"import { useQueryChangedEffect } from 'farrow-next'\n\nconst App = () => {\n  useQueryChangedEffect((currQuery, prevQuery) => {\n    // do something\n  })\n}\n")),Object(a.b)("h3",{id:"controller-api"},"Controller API"),Object(a.b)("h4",{id:"controllerinitialstate"},"controller.initialState"),Object(a.b)("p",null,"Initial state of the ",Object(a.b)("inlineCode",{parentName:"p"},"Controller")," to initialize the ",Object(a.b)("inlineCode",{parentName:"p"},"redux store")),Object(a.b)("h4",{id:"controllerreducers"},"controller.reducers"),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"reducers")," object of a ",Object(a.b)("inlineCode",{parentName:"p"},"Controller")," contains the ",Object(a.b)("inlineCode",{parentName:"p"},"reducer")," function to update the ",Object(a.b)("inlineCode",{parentName:"p"},"state"),"."),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"reducers")," is an object ",Object(a.b)("inlineCode",{parentName:"p"},"{ [key: string]: Reducer }")," whose ",Object(a.b)("inlineCode",{parentName:"p"},"key")," is its ",Object(a.b)("inlineCode",{parentName:"p"},"action-type"),"."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"reducers = {\n  incre(state: CounterState, step = 1) {\n    return {\n      ...state,\n      count: state.count + step,\n    }\n  },\n  decre(state: CounterState, step = 1) {\n    return {\n      ...state,\n      count: state.count - step,\n    }\n  },\n}\n")),Object(a.b)("h4",{id:"controllerstore"},"controller.store"),Object(a.b)("p",null,"Access the ",Object(a.b)("inlineCode",{parentName:"p"},"redux-store")," constructed from ",Object(a.b)("inlineCode",{parentName:"p"},"initialState/reducers")),Object(a.b)("h4",{id:"controllerstate"},"controller.state"),Object(a.b)("p",null,"Accesses the current ",Object(a.b)("inlineCode",{parentName:"p"},"this.store.getState()")," latest state"),Object(a.b)("h4",{id:"controlleractions"},"controller.actions"),Object(a.b)("p",null,"Accesses the ",Object(a.b)("inlineCode",{parentName:"p"},"actions")," update function of ",Object(a.b)("inlineCode",{parentName:"p"},"redux-store"),", with the same structure as ",Object(a.b)("inlineCode",{parentName:"p"},"this.reducers"),"."),Object(a.b)("h4",{id:"controllerpage"},"controller.page"),Object(a.b)("p",null,"Access the data associated with ",Object(a.b)("inlineCode",{parentName:"p"},"NextPageContext"),", structured roughly as follows"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"interface PageInfo {\n  /**\n   * Error object if encountered during rendering\n   */\n  err?:\n    | (Error & {\n        statusCode?: number\n      })\n    | null\n  /**\n   * `HTTP` request object.\n   */\n  req?: IncomingMessage\n  /**\n   * `HTTP` response object.\n   */\n  res?: ServerResponse\n  /**\n   * Path section of `URL`.\n   */\n  pathname: string\n  /**\n   * Query string section of `URL` parsed as an object.\n   */\n  query: ParsedUrlQuery\n  /**\n   * `String` of the actual path including query.\n   */\n  asPath?: string\n}\n")),Object(a.b)("h4",{id:"controllerdevtools"},"controller.devtools"),Object(a.b)("p",null,"Whether to enable ",Object(a.b)("inlineCode",{parentName:"p"},"redux-devtools"),", default is ",Object(a.b)("inlineCode",{parentName:"p"},"true"),"."),Object(a.b)("p",null,"Supports ",Object(a.b)("inlineCode",{parentName:"p"},"boolean | string"),", if it is ",Object(a.b)("inlineCode",{parentName:"p"},"string"),", it will be displayed as the name in ",Object(a.b)("inlineCode",{parentName:"p"},"redux-devtools"),", which can be displayed normally even after compressing the code (the default name is the class name of ",Object(a.b)("inlineCode",{parentName:"p"},"Controller.name"),", which becomes a single letter after compressing."),Object(a.b)("h4",{id:"controllerlogger"},"controller.logger"),Object(a.b)("p",null,"Whether to enable ",Object(a.b)("inlineCode",{parentName:"p"},"redux-logger"),", default is ",Object(a.b)("inlineCode",{parentName:"p"},"false"),"."),Object(a.b)("h4",{id:"controllerfetchurlstring-options-requestinit"},"controller.fetch(url:string, options?: RequestInit)"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"fetch")," method wrapper, automatically handles ",Object(a.b)("inlineCode",{parentName:"p"},"cookie")," passing internally, interface is consistent with global variable ",Object(a.b)("inlineCode",{parentName:"p"},"fetch")),Object(a.b)("p",null,"See ",Object(a.b)("inlineCode",{parentName:"p"},"fetch")," ",Object(a.b)("a",{parentName:"p",href:"https://github.github.io/fetch/"},"documentation")," for more information."),Object(a.b)("h4",{id:"controllergetjsonurlstring-paramsobject-options-requestinit-json"},"controller.getJson(url:string, params?:object, options?: RequestInit): json"),Object(a.b)("p",null,"The controller.getJson method is a method based on the controller.fetch wrapper to make it easier to send get requests."),Object(a.b)("p",null,"The url parameters are handled in the same way as the controller.fetch method."),Object(a.b)("p",null,"The params parameter will be internally querystring.stringify and spliced after the url."),Object(a.b)("p",null,"The options parameter will be passed as options for the fetch."),Object(a.b)("h4",{id:"controllerpostjsonurlstring-bodyobject-optionsrequestinit-json"},"controller.postJson(url:string, body?:object, options?:RequestInit): json"),Object(a.b)("p",null,"The controller.postJson method is based on the controller.fetch wrapper method, and is a simpler way to send post requests."),Object(a.b)("p",null,"The url parameter is handled in the same way as the controller.fetch method."),Object(a.b)("p",null,"If the data is an object, it will be internally JSON.stringify and then sent to the server as a request payload"),Object(a.b)("p",null,"The options parameter will be passed as options for the fetch."),Object(a.b)("h4",{id:"controllergetcookiekeystring"},"controller.getCookie(key:string)"),Object(a.b)("p",null,"controller.getCookie is used to get the value of the cookie corresponding to the key parameter."),Object(a.b)("h4",{id:"controllersetcookiekeystring-valuestring-optionsobject"},"controller.setCookie(key:string, value:string, options?:object)"),Object(a.b)("p",null,"controller.setCookie is used to set the value of the cookie corresponding to the key parameter. The third parameter options is an object, see ",Object(a.b)("a",{parentName:"p",href:"https://github.com/js-cookie/js-cookie#cookie-attributes"},"documentation")),Object(a.b)("h4",{id:"controllerremovecookiekeystring-optionsobject"},"controller.removeCookie(key:string, options?:object)"),Object(a.b)("p",null,"controller.removeCookie is used to remove the value of the cookie corresponding to the key parameter. The third parameter options is an object, see ",Object(a.b)("a",{parentName:"p",href:"https://github.com/js-cookie/js-cookie#cookie-attributes"},"documentation")),Object(a.b)("h4",{id:"controllerredirecturl"},"controller.redirect(url)"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"controller.redirect")," is used to redirect, it will take care the ",Object(a.b)("inlineCode",{parentName:"p"},"server/client"),", and chose the right way to redirect."),Object(a.b)("h4",{id:"controllerisclient"},"controller.isClient"),Object(a.b)("p",null,"controller.isClient is a boolean value that determines whether the client is currently on the server."),Object(a.b)("h4",{id:"controllerisserver"},"controller.isServer"),Object(a.b)("p",null,"controller.isServer is the boolean value that determines whether the client is currently on the server side."),Object(a.b)("h4",{id:"controlleruseragent"},"controller.userAgent"),Object(a.b)("p",null,"Gets the ",Object(a.b)("inlineCode",{parentName:"p"},"userAgent")," string, which can be used to construct other properties or methods such as ",Object(a.b)("inlineCode",{parentName:"p"},"controller.isWeixin"),"."),Object(a.b)("h4",{id:"controllerusecontroller"},"controller.use(Controller)"),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"controller.use")," method is used to implement dependency injection and returns the instance of the used class."),Object(a.b)("p",null,"See ",Object(a.b)("a",{parentName:"p",href:"#dependency-injection"},"Dependency Injection")," for more on this."),Object(a.b)("h3",{id:"controller-life-cycle"},"Controller Life-Cycle"),Object(a.b)("h4",{id:"controllerpreload-promisevoid"},Object(a.b)("inlineCode",{parentName:"h4"},"controller.preload?(): Promise<void>")),Object(a.b)("p",null,"Call on preload phase(before component rendering), you can fetch ",Object(a.b)("inlineCode",{parentName:"p"},"SSR")," related data in this method"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"class Test extends Controller {\n  // Preload data\n  async preload() {\n    let json = await this.postJson(url, this.state.body)\n    this.actions.updateJson(json)\n  }\n}\n")),Object(a.b)("h3",{id:"page-api"},"Page Api"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"import { page } from 'farrow-next'\n\nexport default page({\n  View, // React Component for Page\n  Controllers: {...}, // Controllers for Page\n  Providers: [...], // Optional Providers for Controllers above\n  async preload(ctrls) {}, // preload life-cycle method triggered after all controller.preload() finished\n})\n\n")),Object(a.b)("h3",{id:"dependency-injection"},"Dependency Injection"),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"Controller class")," implements dependency injection, meaning that within a ",Object(a.b)("inlineCode",{parentName:"p"},"Controller"),", instances of other controllers can be injected via ",Object(a.b)("inlineCode",{parentName:"p"},"this.use(Controller)"),", and can even refer to each other."),Object(a.b)("p",null,"This mechanism facilitates modularity by giving preference to combinations over inheritance."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-typescript"},"// Define User controllers\nclass UserCtrl extends Controller {\n  // Login method\n  async login() {\n    await this.getJson('/login')\n  }\n  // login on preload\n  async preload() {\n    await this.login()\n  }\n}\n\n// Define the Product controller\nclass ProductCtrl extends Controller {\n  // Inject user\n  user = this.use(UserCtrl)\n}\n\n// Define Order controller\nclass OrderCtrl extends Controller {\n  // inject user, which is the same instance as the product controller\n  user = this.use(UserCtrl)\n}\n\n// Define the page controller\nclass HomePageCtrl extends Controller {\n  // Inject the other controllers needed for the page\n  user = this.use(UserCtrl)\n  product = this.use(ProductCtrl)\n  order = this.use(OrderCtrl)\n}\n")))}p.isMDXComponent=!0}}]);