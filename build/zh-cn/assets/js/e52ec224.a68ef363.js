(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{107:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return p}));var r=t(3),a=t(7),i=(t(0),t(116)),o={title:"farrow-cors"},l={unversionedId:"api/07-farrow-cors",id:"api/07-farrow-cors",isDocsHomePage:!1,title:"farrow-cors",description:"Cross-Origin Resource Sharing(CORS) for farrow-http",source:"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/api/07-farrow-cors.md",slug:"/api/07-farrow-cors",permalink:"/farrow-docs/build/zh-cn/docs/api/07-farrow-cors",editUrl:"https://github.com/Lucifier129/farrow-docs/docs/api/07-farrow-cors.md",version:"current",sidebar:"docs",previous:{title:"farrow-react",permalink:"/farrow-docs/build/zh-cn/docs/api/06-farrow-react"},next:{title:"farrow-api",permalink:"/farrow-docs/build/zh-cn/docs/api/08-farrow-api"}},s=[{value:"Installation",id:"installation",children:[]},{value:"Usage",id:"usage",children:[{value:"Simple Usage (Enable <em>All</em> CORS Requests)",id:"simple-usage-enable-all-cors-requests",children:[]},{value:"Enable CORS for a Single Route",id:"enable-cors-for-a-single-route",children:[]},{value:"Configuring CORS",id:"configuring-cors",children:[]},{value:"Configuring CORS w/ Dynamic Origin",id:"configuring-cors-w-dynamic-origin",children:[]},{value:"Enabling CORS Pre-Flight",id:"enabling-cors-pre-flight",children:[]},{value:"Configuring CORS Asynchronously",id:"configuring-cors-asynchronously",children:[]}]},{value:"Configuration Options",id:"configuration-options",children:[]}],c={toc:s};function p(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},c,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"Cross-Origin Resource Sharing(CORS) for farrow-http"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#installation"},"Installation")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#usage"},"Usage"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#simple-usage-enable-all-cors-requests"},"Simple Usage (Enable ",Object(i.b)("em",{parentName:"a"},"All")," CORS Requests)")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#enable-cors-for-a-single-route"},"Enable CORS for a Single Route")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#configuring-cors"},"Configuring CORS")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#configuring-cors-w-dynamic-origin"},"Configuring CORS w/ Dynamic Origin")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#enabling-cors-pre-flight"},"Enabling CORS Pre-Flight")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#configuring-cors-asynchronously"},"Configuring CORS Asynchronously")))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"#configuration-options"},"Configuration Options"))),Object(i.b)("h2",{id:"installation"},"Installation"),Object(i.b)("p",null,"This is a ",Object(i.b)("a",{parentName:"p",href:"https://nodejs.org/en/"},"Node.js")," module available through the\n",Object(i.b)("a",{parentName:"p",href:"https://www.npmjs.com/"},"npm registry"),". Installation is done using the\n",Object(i.b)("a",{parentName:"p",href:"https://docs.npmjs.com/getting-started/installing-npm-packages-locally"},Object(i.b)("inlineCode",{parentName:"a"},"npm install")," command"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sh"},"$ npm install farrow-cors\n")),Object(i.b)("h2",{id:"usage"},"Usage"),Object(i.b)("h3",{id:"simple-usage-enable-all-cors-requests"},"Simple Usage (Enable ",Object(i.b)("em",{parentName:"h3"},"All")," CORS Requests)"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"import { Http, Response } from 'farrow-http'\nimport { cors } from 'farrow-cors'\n\nconst http = Http()\n\nhttp.use(cors())\n\nhttp\n  .match({\n    pathname: '/product/:id',\n    params: {\n      id: Number,\n    },\n  })\n  .use(() => {\n    return Response.json({ msg: 'This is CORS-enabled for all origins!' })\n  })\n\nhttp.listen(80, function () {\n  console.log('CORS-enabled web server listening on port 80')\n})\n")),Object(i.b)("h3",{id:"enable-cors-for-a-single-route"},"Enable CORS for a Single Route"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"import { Http, Response } from 'farrow-http'\nimport { cors } from 'farrow-cors'\n\nconst http = Http()\n\nhttp\n  .match({\n    pathname: '/product/:id',\n    params: {\n      id: Number,\n    },\n  })\n  .use(cors())\n  .use(() => {\n    return Response.json({ msg: 'This is CORS-enabled for all origins!' })\n  })\n\nhttp.listen(80, function () {\n  console.log('CORS-enabled web server listening on port 80')\n})\n")),Object(i.b)("h3",{id:"configuring-cors"},"Configuring CORS"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"import { Http, Response } from 'farrow-http'\nimport { cors } from 'farrow-cors'\n\nconst http = Http()\n\nconst corsOptions = {\n  origin: 'http://example.com',\n  optionsSuccessStatus: 200, // some legacy browsers (IE11, various SmartTVs) choke on 204\n}\n\nhttp\n  .match({\n    pathname: '/product/:id',\n    params: {\n      id: Number,\n    },\n  })\n  .use(cors(corsOptions))\n  .use(() => {\n    return Response.json({ msg: 'This is CORS-enabled for all origins!' })\n  })\n\nhttp.listen(80, function () {\n  console.log('CORS-enabled web server listening on port 80')\n})\n")),Object(i.b)("h3",{id:"configuring-cors-w-dynamic-origin"},"Configuring CORS w/ Dynamic Origin"),Object(i.b)("p",null,"This module supports validating the origin dynamically using a function provided\nto the ",Object(i.b)("inlineCode",{parentName:"p"},"origin")," option. This function will be passed a string that is the origin\n(or ",Object(i.b)("inlineCode",{parentName:"p"},"undefined")," if the request has no origin), and a ",Object(i.b)("inlineCode",{parentName:"p"},"callback")," with the signature\n",Object(i.b)("inlineCode",{parentName:"p"},"callback(error, origin)"),"."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"origin")," argument to the callback can be any value allowed for the ",Object(i.b)("inlineCode",{parentName:"p"},"origin"),"\noption of the middleware, except a function. See the\n",Object(i.b)("a",{parentName:"p",href:"#configuration-options"},"configuration options")," section for more information on all\nthe possible value types."),Object(i.b)("p",null,"This function is designed to allow the dynamic loading of allowed origin(s) from\na backing datasource, like a database."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"import { Http, Response } from 'farrow-http'\nimport { cors } from 'farrow-cors'\n\nconst http = Http()\n\nconst corsOptions = {\n  origin: function (origin, callback) {\n    // db.loadOrigins is an example call to load\n    // a list of origins from a backing database\n    db.loadOrigins(function (error, origins) {\n      callback(error, origins)\n    })\n  },\n}\n\nhttp\n  .match({\n    pathname: '/product/:id',\n    params: {\n      id: Number,\n    },\n  })\n  .use(cors(corsOptions))\n  .use(() => {\n    return Response.json({ msg: 'This is CORS-enabled for all origins!' })\n  })\n\nhttp.listen(80, function () {\n  console.log('CORS-enabled web server listening on port 80')\n})\n")),Object(i.b)("h3",{id:"enabling-cors-pre-flight"},"Enabling CORS Pre-Flight"),Object(i.b)("p",null,"Certain CORS requests are considered 'complex' and require an initial\n",Object(i.b)("inlineCode",{parentName:"p"},"OPTIONS")," request (called the \"pre-flight request\"). An example of a\n'complex' CORS request is one that uses an HTTP verb other than\nGET/HEAD/POST (such as DELETE) or that uses custom headers. To enable\npre-flighting, you must add a new OPTIONS handler for the route you want\nto support:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"import { Http, Response } from 'farrow-http'\nimport { cors } from 'farrow-cors'\n\nconst http = Http()\n\n// enable pre-flight request for DELETE request\nhttp\n  .match({\n    pathname: '/product/:id',\n    method: 'OPTIONS',\n  })\n  .use(cors())\n  .use(() => {\n    return Response.text('')\n  })\n\nhttp\n  .match({\n    pathname: '/product/:id',\n    method: 'DELETE',\n    params: {\n      id: Number,\n    },\n  })\n  .use(cors())\n  .use(() => {\n    return Response.json({ msg: 'This is CORS-enabled for all origins!' })\n  })\n\nhttp.listen(80, function () {\n  console.log('CORS-enabled web server listening on port 80')\n})\n")),Object(i.b)("p",null,"You can also enable pre-flight across-the-board like so:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"// include before other routes\nhttp\n  .match({\n    // we can not simple use wildcard here\n    // because Path-To-RegExp breaks compatibility\n    // https://github.com/pillarjs/path-to-regexp#compatibility-with-express--4x\n    pathname: '(.*)',\n    method: 'OPTIONS',\n  })\n  .use(cors())\n  .use(() => {\n    return Response.text('')\n  })\n")),Object(i.b)("p",null,"NOTE: When using this middleware as an application level middleware (for\nexample, ",Object(i.b)("inlineCode",{parentName:"p"},"app.use(cors())"),"), pre-flight requests are already handled for all\nroutes."),Object(i.b)("h3",{id:"configuring-cors-asynchronously"},"Configuring CORS Asynchronously"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"import { Http, Response } from 'farrow-http'\nimport { cors } from 'farrow-cors'\n\nconst http = Http()\n\nlet allowlist = ['http://example1.com', 'http://example2.com']\nlet corsOptionsDelegate = function (req, callback) {\n  let corsOptions\n  if (allowlist.indexOf(req.header('Origin')) !== -1) {\n    corsOptions = { origin: true } // reflect (enable) the requested origin in the CORS response\n  } else {\n    corsOptions = { origin: false } // disable CORS for this request\n  }\n  callback(null, corsOptions) // callback expects two parameters: error and options\n}\n\nhttp.get('/products/<id:int>').use(cors(corsOptionsDelegate), (request, next) => {\n  return Response.json({ msg: 'This is CORS-enabled for an allowed domain.' })\n})\n\nhttp.listen(80, function () {\n  console.log('CORS-enabled web server listening on port 80')\n})\n")),Object(i.b)("h2",{id:"configuration-options"},"Configuration Options"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"origin"),": Configures the ",Object(i.b)("strong",{parentName:"li"},"Access-Control-Allow-Origin")," CORS header. Possible values:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"Boolean")," - set ",Object(i.b)("inlineCode",{parentName:"li"},"origin")," to ",Object(i.b)("inlineCode",{parentName:"li"},"true")," to reflect the ",Object(i.b)("a",{parentName:"li",href:"http://tools.ietf.org/html/draft-abarth-origin-09"},"request origin"),", as defined by ",Object(i.b)("inlineCode",{parentName:"li"},"req.header('Origin')"),", or set it to ",Object(i.b)("inlineCode",{parentName:"li"},"false")," to disable CORS."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"String")," - set ",Object(i.b)("inlineCode",{parentName:"li"},"origin")," to a specific origin. For example if you set it to ",Object(i.b)("inlineCode",{parentName:"li"},'"http://example.com"'),' only requests from "',Object(i.b)("a",{parentName:"li",href:"http://example.com%22"},'http://example.com"')," will be allowed."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"RegExp")," - set ",Object(i.b)("inlineCode",{parentName:"li"},"origin")," to a regular expression pattern which will be used to test the request origin. If it's a match, the request origin will be reflected. For example the pattern ",Object(i.b)("inlineCode",{parentName:"li"},"/example\\.com$/"),' will reflect any request that is coming from an origin ending with "example.com".'),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"Array")," - set ",Object(i.b)("inlineCode",{parentName:"li"},"origin")," to an array of valid origins. Each origin can be a ",Object(i.b)("inlineCode",{parentName:"li"},"String")," or a ",Object(i.b)("inlineCode",{parentName:"li"},"RegExp"),". For example ",Object(i.b)("inlineCode",{parentName:"li"},'["http://example1.com", /\\.example2\\.com$/]'),' will accept any request from "',Object(i.b)("a",{parentName:"li",href:"http://example1.com%22"},'http://example1.com"'),' or from a subdomain of "example2.com".'),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"Function")," - set ",Object(i.b)("inlineCode",{parentName:"li"},"origin")," to a function implementing some custom logic. The function takes the request origin as the first parameter and a callback (called as ",Object(i.b)("inlineCode",{parentName:"li"},"callback(err, origin)"),", where ",Object(i.b)("inlineCode",{parentName:"li"},"origin")," is a non-function value of the ",Object(i.b)("inlineCode",{parentName:"li"},"origin")," option) as the second."))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"methods"),": Configures the ",Object(i.b)("strong",{parentName:"li"},"Access-Control-Allow-Methods")," CORS header. Expects a comma-delimited string (ex: 'GET,PUT,POST') or an array (ex: ",Object(i.b)("inlineCode",{parentName:"li"},"['GET', 'PUT', 'POST']"),")."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"allowedHeaders"),": Configures the ",Object(i.b)("strong",{parentName:"li"},"Access-Control-Allow-Headers")," CORS header. Expects a comma-delimited string (ex: 'Content-Type,Authorization') or an array (ex: ",Object(i.b)("inlineCode",{parentName:"li"},"['Content-Type', 'Authorization']"),"). If not specified, defaults to reflecting the headers specified in the request's ",Object(i.b)("strong",{parentName:"li"},"Access-Control-Request-Headers")," header."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"exposedHeaders"),": Configures the ",Object(i.b)("strong",{parentName:"li"},"Access-Control-Expose-Headers")," CORS header. Expects a comma-delimited string (ex: 'Content-Range,X-Content-Range') or an array (ex: ",Object(i.b)("inlineCode",{parentName:"li"},"['Content-Range', 'X-Content-Range']"),"). If not specified, no custom headers are exposed."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"credentials"),": Configures the ",Object(i.b)("strong",{parentName:"li"},"Access-Control-Allow-Credentials")," CORS header. Set to ",Object(i.b)("inlineCode",{parentName:"li"},"true")," to pass the header, otherwise it is omitted."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"maxAge"),": Configures the ",Object(i.b)("strong",{parentName:"li"},"Access-Control-Max-Age")," CORS header. Set to an integer to pass the header, otherwise it is omitted."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"preflightContinue"),": Pass the CORS preflight response to the next handler."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"optionsSuccessStatus"),": Provides a status code to use for successful ",Object(i.b)("inlineCode",{parentName:"li"},"OPTIONS")," requests, since some legacy browsers (IE11, various SmartTVs) choke on ",Object(i.b)("inlineCode",{parentName:"li"},"204"),".")),Object(i.b)("p",null,"The default configuration is the equivalent of:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "origin": "*",\n  "methods": "GET,HEAD,PUT,PATCH,POST,DELETE",\n  "preflightContinue": false,\n  "optionsSuccessStatus": 204\n}\n')),Object(i.b)("p",null,"For details on the effect of each CORS header, read ",Object(i.b)("a",{parentName:"p",href:"http://www.html5rocks.com/en/tutorials/cors/"},"this")," article on HTML5 Rocks."))}p.isMDXComponent=!0},116:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return d}));var r=t(0),a=t.n(r);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=a.a.createContext({}),p=function(e){var n=a.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},b=function(e){var n=p(e.components);return a.a.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},m=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),b=p(t),m=r,d=b["".concat(o,".").concat(m)]||b[m]||u[m]||i;return t?a.a.createElement(d,l(l({ref:n},c),{},{components:t})):a.a.createElement(d,l({ref:n},c))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=t[c];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);